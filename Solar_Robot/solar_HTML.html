<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
	<link rel="stylesheet" href="solar_CSS.css">
	
</head>
<body>
		<div class="khoi1">
			
			<!-- khoi 1 -->
			<div class="thongtin">
				<!-- <img class="anh1" src="http://dut.udn.vn/Files/admin/images/Tin_tuc/Khac/2020/LogoDUT/image002.jpg"> -->
				<img class="anh1" src="khoa.jfif">
				<div class="logo">

					
					<div class="logo_giua">
				
						<h2>ĐẠI HỌC BÁCH KHOA</h2>
						<h2>ĐẠI HỌC ĐÀ NẴNG</h2>
						<h2>KHOA ĐIỆN </h2>
					</div>
					<h1>ĐỒ ÁN TỐT NGHIỆP</h1>
					<h2>SUB-GHZ</h2>

				</div>	
				<img class="anh2" src="shinko.jpg">	
										
			</div>	
			<div class="logo_duoi">
					<h3>GVHD: TS. NGÔ ĐÌNH THANH</h3>
					<h3>SVTH: MINH  - ĐỨC  - ĐẠT - 19TDHCLC2</h3>
					
				</div>	
				<h3 class="duoi_1">ĐDCT: NGUYỄN CHÍ THẮNG </h3>
		</div>

<!-------------- hoạt động chung --------------->

	<div class="khoi2">

	<!-- khoi ket nối -->
<!-- 		<div class="ketnoi">
		<div class="tieude"><h3>Vui lòng kết nối Internet</h3></div>
			<iframe src="https://www.google.com/" width="100%" height="500px" name="the-iframe" frameborder="0"></iframe>
			<p>IP:<span id="IPconnect"> </span></p>

		</div> -->

	<!-- khối điều khiển -->
		<div class="dieukhien">


			<div class="tieude">
				<h3>THÔNG SỐ HIỆN TẠI </h3>
				<!-- <h3>ĐIỀU KHIỂN TRÊN ROBOT</h3> -->
			</div>

            <div class = "chedo">
            	<p>GIÁ TRỊ  PV </p>
                <div  id ="PV1">
				<h3> PV : <span id="giatriPV">00</span>(C)</h3>
			
                  <!--  <div class = "inner-circle"></div>  --> 
                </div>
				
            </div>
            
			<div class="tieude">
				
				<!-- <h3>ĐIỀU KHIỂN TRÊN ROBOT</h3> -->
			</div>

            <div class = "chedo">
            	<p>GIÁ TRỊ  SV </p>
                <div  id ="SV1">
				<h3> SV : <span id="giatriSV">00</span>(C)</h3>
			
                  <!--  <div class = "inner-circle"></div>  --> 
                </div>
				
            </div>

			<div class="tieude">
				<h3>THÔNG SỐ CÀI ĐẶT </h3>
			</div>

			<div class = "chedo">
            	<p>GIÁ TRỊ SV </p>
                <div class = "PV" id ="act">
					 <input type="text" name="SV" id="CV1" value="Nhập giá trị" >
					<br />
					<div class = "inner-circle"></div>
					
                </div>
				<button id= "send" type="submit" >Submit</button>
            </div>
			
			
            
			<!--<div class="ketnoi">-->
			<div class="tieude">
				<h3>ĐỊA CHỈ WIFI CỦA THIẾT BỊ</h3>
			</div>
			
			<div class = "chedo">
			<p> <span id="currentDateTime"></span></p>
			<p>IP: <span id="IPconnect"> </span> hoặc 192.168.4.1
			<span id="currentDateTime"></span>
			</p>
			</div>	
		
			<!-- Vùng hiển thị biểu đồ -->
			
			<div class="btn_" id="myChart">
					<!-- cấu hình chi đó -->
				
			</div>
			<canvas id="myChart"></canvas>	
		</div>
			
		


	<!-- khoi hiển thị -->

		<div class="hienthi">

				<div class="to">
				<h3>NHIỆT ĐỘ HIỆN TẠI </h3>
			</div>
			<div class="progress">
					<input class="slider" type="range" min="0" max="255" value="0" id="sliderCar"> <!-- create slider-->
	                <div class="Value">
	                	<p>Value:<span id="SelectValueCar"> </span></p>
	                </div>		<!-- indicate value to website-->
	        </div>


	        <div class="tocdochoi">
				<h3>NHIỆT ĐỘ ĐIỀU KHIỂN </h3>
			</div>
			<div class="progress">
					<input class="slider" type="range" min="0" max="255" value="0" id="sliderBrush"> <!-- create slider-->
	                <div class="Value">
	                	<p>Value:<span id="SelectValueBrush"> </span></p>
	                </div>		<!-- indicate value to website-->
	        </div>

		<div class="tieude">
			<h3>BIỂU ĐỒ </h3>
		
		</div>
		<canvas id="myChart">huhu</canvas>
		

		


	</div>	

		<!-- file Js -->
		
	</div>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js" integrity="sha512-6jitJ9C8bSrbGuRDad7MgOEv1gITvwiI7xZ7RNMHe5Z51BQgDkTChFIkHHqdGtu5L9/CBXx0ajAaIGw5/tEjhA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script type="module">
		
		
		// Import the functions you need from the SDKs you need
		import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
		import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics.js";
		import {getDatabase, ref, get, set, child, update, remove, onValue}
		from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"
		
		// TODO: Add SDKs for Firebase products that you want to use
		// https://firebase.google.com/docs/web/setup#available-libraries
		
		// Your web app's Firebase configuration
		// For Firebase JS SDK v7.20.0 and later, measurementId is optional
		const firebaseConfig = {
			apiKey: "AIzaSyBkX1ieE1j2bAbY33XiNojMEHzZyJEP5-w",
			authDomain: "bbbcc-22472.firebaseapp.com",
			databaseURL: "https://bbbcc-22472-default-rtdb.firebaseio.com",
			projectId: "bbbcc-22472",
			storageBucket: "bbbcc-22472.appspot.com",
			messagingSenderId: "670082950114",
			appId: "1:670082950114:web:5c5b46f9ec3f39ee884fbb",
			measurementId: "G-M3KYQY0F66"
		};

		// Initialize Firebase
		// Khởi tạo Firebase
		
		const app = initializeApp(firebaseConfig);
		const analytics = getAnalytics(app);
		
		//firebase.initializeApp(firebaseConfig);
		//var database = firebase.database();
		const db = getDatabase();
		
		var enterID = document.querySelector("#CV1");
		  
		var insertBtn = document.querySelector("#send");
		
				function wirteData() {
					set(ref(db, "DATA2/"),{
						
						SV: CV1.value,
						
					})
					.then(()=>{
						alert("Data added successfully");
					})
					.catch((error)=>{
						alert(error);
					});
				}
		
				insertBtn.addEventListener('click', wirteData);
	
				/*
				var valueTemp = firebase.database().ref('DATA').child('CV');
				valueTemp.on('value',snap =>{
				//console.log("nhiet do : " + snap.val());
				document.getElementById("PV1").innerHTML=snap.val()+" C";
				});
				
				
				*/
			// lay du lieu //
				
				const starCountRefPV = ref(db, 'DATA1/PV');
				onValue(starCountRefPV, (snapshot) => {
					const data0 = snapshot.val();
					console.log(">>>>>>>>>>>>",data0);
					document.getElementById('giatriPV').innerHTML = data0;
				});
				
				const starCountRefSV = ref(db, 'DATA1/SV');
				onValue(starCountRefSV, (snapshot) => {
					const data1 = snapshot.val();
					console.log(">>>>>>>>>>>>",data1);
					document.getElementById('giatriSV').innerHTML = data1;
				});
			// hiển thị thời gian 	//
			function updateTime() {
			var currentDate = new Date();
			var year = currentDate.getFullYear();
			var month = (currentDate.getMonth() + 1).toString().padStart(2, '0');
			var day = currentDate.getDate().toString().padStart(2, '0');
			var hour = currentDate.getHours().toString().padStart(2, '0');
			var minute = currentDate.getMinutes().toString().padStart(2, '0');
			var second = currentDate.getSeconds().toString().padStart(2, '0');

			var dateTimeString = hour + ':' + minute + ':' + second + ', ' + day + '/' + month + '/' + year;

			// Cập nhật nội dung trong phần tử có id "currentDateTime"
			document.getElementById('currentDateTime').textContent = dateTimeString;
			}

			// Cập nhật thời gian mỗi giây
			setInterval(updateTime, 1000);	

			// vẽ biểu đồ //
			// Tạo biểu đồ rỗng
			var ctx = document.getElementById('myChart').getContext('2d');
			var myChart = new Chart(ctx, {
			type: 'line',
			data: {
				labels: [],
				datasets: [{
				label: 'Nhiệt độ',
				data: [],
				borderColor: 'blue',
				fill: false
				}]
			},
			options: {
				scales: {
				x: {
					title: {
					display: true,
					text: 'Thời gian'
					}
				},
				y: {
					title: {
					display: true,
					text: 'Nhiệt độ'
					}
				}
				},
				responsive: true
			}
			});

			// Kết nối WebSocket với máy chủ
			var socket = new WebSocket('ws://bbbcc-22472-default-rtdb.firebaseio.com');

			// Xử lý sự kiện nhận dữ liệu từ máy chủ
			socket.onmessage = function(event) {
			var data = JSON.parse(event.data);

			// Thêm dữ liệu nhiệt độ và thời gian mới vào biểu đồ
			myChart.data.labels.push(data.time);
			myChart.data.datasets[0].data.push(data.temperature);

			// Giới hạn số lượng dữ liệu hiển thị trong biểu đồ (ví dụ: 10 điểm)
			var maxDataPoints = 10;
			if (myChart.data.labels.length > maxDataPoints) {
				myChart.data.labels.shift();
				myChart.data.datasets[0].data.shift();
			}

			// Cập nhật biểu đồ
			myChart.update();
			};	
				
	</script>
</body>
</html>